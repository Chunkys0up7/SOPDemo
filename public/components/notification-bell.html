<!-- Notification Bell Component -->
<!-- Include this in any page's header to show notification alerts -->

<style>
  .notification-bell {
    position: relative;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #f7fafc;
    transition: all 0.2s;
  }

  .notification-bell:hover {
    background: #e2e8f0;
  }

  .notification-bell-icon {
    font-size: 20px;
    animation: bellRing 2s ease-in-out infinite;
  }

  .notification-badge {
    position: absolute;
    top: 2px;
    right: 2px;
    background: #dc2626;
    color: white;
    font-size: 11px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  .notification-dropdown {
    position: absolute;
    top: calc(100% + 12px);
    right: 0;
    width: 420px;
    max-height: 600px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    display: none;
    flex-direction: column;
    z-index: 1000;
    overflow: hidden;
  }

  .notification-dropdown.active {
    display: flex;
  }

  .notification-dropdown-header {
    padding: 16px 20px;
    border-bottom: 2px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .notification-dropdown-header h3 {
    font-size: 16px;
    font-weight: 700;
    color: #2d3748;
  }

  .notification-dropdown-actions {
    display: flex;
    gap: 12px;
  }

  .notification-dropdown-actions button {
    padding: 6px 12px;
    border: none;
    background: #e2e8f0;
    color: #4a5568;
    font-size: 12px;
    font-weight: 600;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .notification-dropdown-actions button:hover {
    background: #cbd5e0;
  }

  .notification-dropdown-list {
    flex: 1;
    overflow-y: auto;
    max-height: 480px;
  }

  .notification-dropdown-item {
    padding: 16px 20px;
    border-bottom: 1px solid #f7fafc;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    gap: 12px;
  }

  .notification-dropdown-item:hover {
    background: #f7fafc;
  }

  .notification-dropdown-item.unread {
    background: #ebf4ff;
    border-left: 4px solid #0052CC;
  }

  .notification-dropdown-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .notification-dropdown-icon.update {
    background: #e6fffa;
    color: #319795;
  }

  .notification-dropdown-icon.approval {
    background: #fef5e7;
    color: #d97706;
  }

  .notification-dropdown-icon.mention {
    background: #fce7f3;
    color: #db2777;
  }

  .notification-dropdown-icon.system {
    background: #e0e7ff;
    color: #4f46e5;
  }

  .notification-dropdown-content {
    flex: 1;
    min-width: 0;
  }

  .notification-dropdown-title {
    font-size: 13px;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .notification-dropdown-text {
    font-size: 12px;
    color: #718096;
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .notification-dropdown-time {
    font-size: 11px;
    color: #a0aec0;
    margin-top: 4px;
  }

  .notification-dropdown-footer {
    padding: 12px 20px;
    border-top: 2px solid #e2e8f0;
    text-align: center;
  }

  .notification-dropdown-footer a {
    color: #0052CC;
    text-decoration: none;
    font-size: 13px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
  }

  .notification-dropdown-footer a:hover {
    color: #003d99;
  }

  .notification-empty {
    padding: 60px 20px;
    text-align: center;
    color: #a0aec0;
  }

  .notification-empty-icon {
    font-size: 48px;
    margin-bottom: 12px;
  }

  .notification-empty-text {
    font-size: 14px;
    color: #718096;
  }

  @keyframes bellRing {
    0%, 100% { transform: rotate(0deg); }
    10%, 30% { transform: rotate(-10deg); }
    20%, 40% { transform: rotate(10deg); }
    50%, 90% { transform: rotate(0deg); }
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    .notification-dropdown {
      width: calc(100vw - 40px);
      right: -20px;
    }
  }
</style>
<!-- component styles migrated to /public/assets/css/common.css -->
<div id="notificationBell" class="notification-bell" onclick="toggleNotifications()">
  <span class="notification-bell-icon">üîî</span>
  <span class="notification-badge" id="notificationBadge">18</span>

  <div class="notification-dropdown" id="notificationDropdown">
    <div class="notification-dropdown-header">
      <h3>üîî Notifications</h3>
      <div class="notification-dropdown-actions">
        <button onclick="markAllDropdownRead(event)">Mark all read</button>
      </div>
    </div>

    <div class="notification-dropdown-list" id="notificationDropdownList">
      <!-- Recent notifications (populated by JavaScript) -->
    </div>

    <div class="notification-dropdown-footer">
      <a href="#" onclick="alert('Notifications page coming soon'); return false;">
        View All Notifications ‚Üí
      </a>
    </div>
  </div>
</div>

<script>
  // Notification data (in production, fetch from API)
  const recentNotifications = [
    {
      id: 1,
      type: 'update',
      icon: 'üîÑ',
      iconClass: 'update',
      title: 'Critical: AUS Processing Updated',
      text: 'SOP-MF-002 v3.2.0 - Fannie Mae changed DU validation requirements',
      time: '12 min ago',
      unread: true,
      link: 'sop-viewer.html?sop=sop-mf-002'
    },
    {
      id: 2,
      type: 'approval',
      icon: 'üìù',
      iconClass: 'approval',
      title: 'Approval Required: Wire Transfer',
      text: 'Maria Gonzalez requested approval for SOP-MF-005 changes',
      time: '1 hour ago',
      unread: true,
      link: 'sop-viewer.html?sop=sop-mf-005&mode=approve'
    },
    {
      id: 3,
      type: 'mention',
      icon: '@',
      iconClass: 'mention',
      title: 'You were mentioned',
      text: 'Emily Patterson mentioned you in SOP-MF-004 comments',
      time: '2 hours ago',
      unread: true,
      link: 'sop-viewer.html?sop=sop-mf-004#comments'
    },
    {
      id: 4,
      type: 'update',
      icon: 'üîÑ',
      iconClass: 'update',
      title: 'TRID Compliance Updated',
      text: 'SOP-MF-010 v2.8.0 - New CFPB guidance on timing requirements',
      time: 'Yesterday',
      unread: false,
      link: 'sop-viewer.html?sop=sop-mf-010'
    },
    {
      id: 5,
      type: 'system',
      icon: '‚öôÔ∏è',
      iconClass: 'system',
      title: 'Weekly Digest Ready',
      text: '12 SOPs updated, 3 new SOPs published, 47 team comments',
      time: '2 days ago',
      unread: false,
      link: '#'
    }
  ];

  // Populate notification dropdown
  function populateNotificationDropdown() {
    const list = document.getElementById('notificationDropdownList');

    if (recentNotifications.length === 0) {
      list.innerHTML = `
        <div class="notification-empty">
          <div class="notification-empty-icon">‚úÖ</div>
          <div class="notification-empty-text">You're all caught up!</div>
        </div>
      `;
      return;
    }

    list.innerHTML = recentNotifications.map(notification => `
      <div class="notification-dropdown-item ${notification.unread ? 'unread' : ''}"
           onclick="openNotification(event, '${notification.link}', ${notification.id})">
        <div class="notification-dropdown-icon ${notification.iconClass}">
          ${notification.icon}
        </div>
        <div class="notification-dropdown-content">
          <div class="notification-dropdown-title">${notification.title}</div>
          <div class="notification-dropdown-text">${notification.text}</div>
          <div class="notification-dropdown-time">${notification.time}</div>
        </div>
      </div>
    `).join('');

    // Update badge count
    const unreadCount = recentNotifications.filter(n => n.unread).length;
    const badge = document.getElementById('notificationBadge');
    if (unreadCount > 0) {
      badge.textContent = unreadCount;
      badge.style.display = 'block';
    } else {
      badge.style.display = 'none';
    }
  }

  // Toggle dropdown
  function toggleNotifications() {
    const dropdown = document.getElementById('notificationDropdown');
    dropdown.classList.toggle('active');

    if (dropdown.classList.contains('active')) {
      populateNotificationDropdown();
    }
  }

  // Open notification
  function openNotification(event, link, notificationId) {
    event.stopPropagation();

    // Mark as read
    const notification = recentNotifications.find(n => n.id === notificationId);
    if (notification) {
      notification.unread = false;
    }

    // Navigate to link
    window.location.href = link;
  }

  // Mark all as read
  function markAllDropdownRead(event) {
    event.stopPropagation();

    recentNotifications.forEach(n => n.unread = false);
    populateNotificationDropdown();

    // Show confirmation
    const btn = event.target;
    const originalText = btn.textContent;
    btn.textContent = '‚úì Done';
    setTimeout(() => {
      btn.textContent = originalText;
    }, 2000);
  }

  // Close dropdown when clicking outside
  document.addEventListener('click', function(event) {
    const bell = document.getElementById('notificationBell');
    const dropdown = document.getElementById('notificationDropdown');

    if (!bell?.contains(event.target)) {
      dropdown?.classList.remove('active');
    }
  });

  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', populateNotificationDropdown);
  } else {
    populateNotificationDropdown();
  }

  // Simulate new notifications (demo only)
  // In production: use WebSocket or polling to get real-time updates
  setInterval(() => {
    // Randomly add new notification (10% chance every 30 seconds)
    if (Math.random() < 0.1) {
      const newNotification = {
        id: Date.now(),
        type: 'update',
        icon: 'üîÑ',
        iconClass: 'update',
        title: 'New SOP Update',
        text: 'A SOP you follow has been updated',
        time: 'Just now',
        unread: true,
        link: '#'
      };

      recentNotifications.unshift(newNotification);
      if (recentNotifications.length > 10) {
        recentNotifications.pop();
      }

      populateNotificationDropdown();

      // Trigger bell animation
      const bellIcon = document.querySelector('.notification-bell-icon');
      bellIcon.style.animation = 'none';
      setTimeout(() => {
        bellIcon.style.animation = 'bellRing 2s ease-in-out infinite';
      }, 10);
    }
  }, 30000); // Check every 30 seconds
</script>
