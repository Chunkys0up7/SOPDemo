<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOP Dependencies - Detailed View</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f7fafc;
      min-height: 100vh;
    }

    .page-wrapper {
      background: linear-gradient(135deg, #0052CC 0%, #003d99 100%);
      min-height: calc(100vh - 65px);
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    h1 {
      color: #2d3748;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #718096;
      font-size: 14px;
    }

    .breadcrumb {
      color: #718096;
      font-size: 13px;
      margin-bottom: 15px;
    }

    .breadcrumb a {
      color: #0052CC;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .card h2 {
      color: #2d3748;
      font-size: 18px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e2e8f0;
    }

    .sop-info {
      margin-bottom: 15px;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f7fafc;
      font-size: 14px;
    }

    .info-label {
      color: #718096;
      font-weight: 600;
    }

    .info-value {
      color: #2d3748;
    }

    .section-list {
      list-style: none;
    }

    .section-item {
      padding: 10px;
      margin: 5px 0;
      background: #f7fafc;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .section-item:hover {
      background: #edf2f7;
      border-left-color: #0052CC;
      transform: translateX(3px);
    }

    .section-item.has-deps {
      border-left-color: #ed8936;
    }

    .section-item.is-referenced {
      border-left-color: #48bb78;
    }

    .section-title {
      font-weight: 600;
      color: #2d3748;
      font-size: 14px;
      margin-bottom: 3px;
    }

    .section-meta {
      font-size: 12px;
      color: #a0aec0;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 5px;
    }

    .badge-deps {
      background: #fef5e7;
      color: #975a16;
    }

    .badge-refs {
      background: #c6f6d5;
      color: #22543d;
    }

    .dependency-view {
      min-height: 600px;
    }

    .dep-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .view-tabs {
      display: flex;
      gap: 10px;
    }

    .tab {
      padding: 8px 16px;
      border: none;
      background: #f7fafc;
      color: #4a5568;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .tab:hover {
      background: #edf2f7;
    }

    .tab.active {
      background: #0052CC;
      color: white;
    }

    .dep-section {
      margin-bottom: 30px;
    }

    .dep-section h3 {
      color: #2d3748;
      font-size: 16px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dep-count {
      background: #0052CC;
      color: white;
      padding: 2px 10px;
      border-radius: 12px;
      font-size: 12px;
    }

    .dependency-item {
      background: #f7fafc;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 4px solid #0052CC;
    }

    .dep-item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 10px;
    }

    .dep-source {
      font-weight: 600;
      color: #2d3748;
      font-size: 15px;
    }

    .dep-arrow {
      color: #a0aec0;
      font-size: 20px;
      margin: 0 10px;
    }

    .dep-target {
      color: #0052CC;
      font-weight: 600;
    }

    .dep-type {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .dep-type-strong {
      background: #fed7d7;
      color: #742a2a;
    }

    .dep-type-medium {
      background: #feebc8;
      color: #7c2d12;
    }

    .dep-type-weak {
      background: #e6fffa;
      color: #234e52;
    }

    .dep-description {
      color: #4a5568;
      font-size: 14px;
      margin-top: 8px;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }

    .dep-reason {
      color: #718096;
      font-size: 13px;
      font-style: italic;
      margin-top: 5px;
    }

    .section-details {
      background: #edf2f7;
      padding: 12px;
      margin-top: 10px;
      border-radius: 6px;
      font-size: 13px;
    }

    .section-ref {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 5px 0;
    }

    .section-ref-icon {
      color: #0052CC;
      font-weight: bold;
    }

    .graph-view {
      background: white;
      padding: 20px;
      border-radius: 8px;
      min-height: 400px;
      display: none;
    }

    .graph-view.active {
      display: block;
    }

    .graph-canvas {
      width: 100%;
      height: 500px;
      border: 2px dashed #e2e8f0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f7fafc;
    }

    .graph-placeholder {
      text-align: center;
      color: #a0aec0;
    }

    .impact-warning {
      background: #fff5f5;
      border: 2px solid #feb2b2;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .impact-warning-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .impact-warning-icon {
      font-size: 24px;
    }

    .impact-warning-title {
      font-weight: 600;
      color: #742a2a;
    }

    .impact-warning-text {
      color: #742a2a;
      font-size: 14px;
    }

    .legend {
      background: #f7fafc;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .legend-title {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .legend-items {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    .list-view {
      display: block;
    }

    .list-view.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Global Navigation -->
  <script>
    // Load global navigation component
    fetch('/public/components/global-nav.html')
      .then(response => response.text())
      .then(html => {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        document.body.insertBefore(tempDiv.firstChild, document.body.firstChild);
      });
  </script>

  <div class="page-wrapper">
    <div class="container">
    <header>
      <div class="breadcrumb">
        <a href="/">Home</a> / <a href="/dist/visualizations/sop-graph.html">Graph</a> / SOP Dependencies
      </div>
      <h1>üîó SOP Dependency Analysis</h1>
      <p class="subtitle">Understand how sections and procedures connect across your documentation</p>
    </header>

    <div class="main-grid">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="card">
          <h2>üìÑ SOP Information</h2>
          <div class="sop-info">
            <div class="info-item">
              <span class="info-label">ID:</span>
              <span class="info-value" id="sopId">sop-001</span>
            </div>
            <div class="info-item">
              <span class="info-label">Title:</span>
              <span class="info-value" id="sopTitle">User Onboarding</span>
            </div>
            <div class="info-item">
              <span class="info-label">Version:</span>
              <span class="info-value" id="sopVersion">1.2.0</span>
            </div>
            <div class="info-item">
              <span class="info-label">Owner:</span>
              <span class="info-value" id="sopOwner">HR Department</span>
            </div>
            <div class="info-item">
              <span class="info-label">Status:</span>
              <span class="info-value" id="sopStatus">Active</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>üìë Sections</h2>
          <ul class="section-list" id="sectionList">
            <!-- Sections will be populated here -->
          </ul>
        </div>

        <div class="card">
          <h2>üìä Dependency Stats</h2>
          <div class="sop-info">
            <div class="info-item">
              <span class="info-label">Depends On:</span>
              <span class="info-value" id="depsCount">2 SOPs</span>
            </div>
            <div class="info-item">
              <span class="info-label">Used By:</span>
              <span class="info-value" id="usedByCount">1 SOP</span>
            </div>
            <div class="info-item">
              <span class="info-label">Total Sections:</span>
              <span class="info-value" id="sectionsCount">8</span>
            </div>
            <div class="info-item">
              <span class="info-label">Section Deps:</span>
              <span class="info-value" id="sectionDepsCount">5</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="dependency-view card">
        <div class="dep-header">
          <h2>Dependency Details</h2>
          <div class="view-tabs">
            <button class="tab active" onclick="switchView('list')">üìã List View</button>
            <button class="tab" onclick="switchView('graph')">üî∑ Graph View</button>
          </div>
        </div>

        <!-- Impact Warning -->
        <div class="impact-warning">
          <div class="impact-warning-header">
            <span class="impact-warning-icon">‚ö†Ô∏è</span>
            <span class="impact-warning-title">High Impact Dependencies</span>
          </div>
          <p class="impact-warning-text">
            This SOP has <strong>2 strong dependencies</strong>. Changes may affect downstream procedures.
            Review all dependent sections before making modifications.
          </p>
        </div>

        <!-- List View -->
        <div class="list-view" id="listView">
          <!-- Dependencies This SOP Has -->
          <div class="dep-section">
            <h3>
              ‚¨áÔ∏è This SOP Depends On
              <span class="dep-count" id="outgoingCount">2</span>
            </h3>
            <div id="outgoingDeps">
              <!-- Will be populated by JS -->
            </div>
          </div>

          <!-- Dependencies On This SOP -->
          <div class="dep-section">
            <h3>
              ‚¨ÜÔ∏è Other SOPs Depend On This
              <span class="dep-count" id="incomingCount">1</span>
            </h3>
            <div id="incomingDeps">
              <!-- Will be populated by JS -->
            </div>
          </div>

          <!-- Section-Level Dependencies -->
          <div class="dep-section">
            <h3>
              üîó Section-Level Dependencies
              <span class="dep-count" id="sectionDepsDetailCount">5</span>
            </h3>
            <div id="sectionDeps">
              <!-- Will be populated by JS -->
            </div>
          </div>
        </div>

        <!-- Graph View -->
        <div class="graph-view" id="graphView">
          <div class="graph-canvas">
            <div class="graph-placeholder">
              <div style="font-size: 48px; margin-bottom: 15px;">üî∑</div>
              <div>Interactive dependency graph</div>
              <div style="font-size: 12px; color: #cbd5e0; margin-top: 5px;">
                Would integrate with D3.js or vis.js for live visualization
              </div>
            </div>
          </div>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-title">Legend</div>
          <div class="legend-items">
            <div class="legend-item">
              <div class="legend-color" style="background: #fed7d7;"></div>
              <span>Strong Dependency (blocking)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #feebc8;"></div>
              <span>Medium Dependency (important)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #e6fffa;"></div>
              <span>Weak Dependency (reference)</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #0052CC;"></div>
              <span>Section Reference</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mock data for SOP-001
    const sopData = {
      id: 'sop-001',
      title: 'User Onboarding Process',
      version: '1.2.0',
      owner: 'HR Department',
      status: 'Active',
      sections: [
        {
          id: 'overview',
          title: 'Overview',
          hasDependencies: false,
          isReferenced: false
        },
        {
          id: 'prerequisites',
          title: 'Prerequisites',
          hasDependencies: true,
          isReferenced: true,
          dependsOn: [
            {sop: 'sop-002', section: 'account-setup', type: 'strong'}
          ],
          referencedBy: [
            {sop: 'sop-005', section: 'week-1-tasks'}
          ]
        },
        {
          id: 'day-1-checklist',
          title: 'Day 1 Checklist',
          hasDependencies: true,
          isReferenced: true,
          dependsOn: [
            {sop: 'sop-002', section: 'system-access', type: 'strong'},
            {sop: 'sop-003', section: 'training-modules', type: 'medium'}
          ],
          referencedBy: [
            {sop: 'sop-005', section: 'onboarding-timeline'}
          ]
        },
        {
          id: 'week-1-tasks',
          title: 'Week 1 Tasks',
          hasDependencies: true,
          isReferenced: false,
          dependsOn: [
            {sop: 'sop-003', section: 'security-training', type: 'strong'}
          ]
        },
        {
          id: 'equipment-setup',
          title: 'Equipment Setup',
          hasDependencies: false,
          isReferenced: true,
          referencedBy: [
            {sop: 'sop-005', section: 'week-1-tasks'}
          ]
        },
        {
          id: 'manager-meeting',
          title: 'Manager 1:1 Meeting',
          hasDependencies: false,
          isReferenced: false
        },
        {
          id: 'success-criteria',
          title: 'Success Criteria',
          hasDependencies: false,
          isReferenced: true,
          referencedBy: [
            {sop: 'sop-005', section: 'evaluation'}
          ]
        },
        {
          id: 'appendix',
          title: 'Appendix & Resources',
          hasDependencies: false,
          isReferenced: false
        }
      ],
      outgoingDeps: [
        {
          target: 'sop-002',
          targetTitle: 'IT System Access Provisioning',
          type: 'strong',
          description: 'User onboarding requires IT system access to be completed first',
          reason: 'Cannot complete onboarding without system access',
          sections: [
            {from: 'prerequisites', to: 'account-setup'},
            {from: 'day-1-checklist', to: 'system-access'}
          ]
        },
        {
          target: 'sop-003',
          targetTitle: 'Security Training Completion',
          type: 'strong',
          description: 'All new hires must complete security training during week 1',
          reason: 'Compliance requirement for all new hires',
          sections: [
            {from: 'day-1-checklist', to: 'training-modules'},
            {from: 'week-1-tasks', to: 'security-training'}
          ]
        }
      ],
      incomingDeps: [
        {
          source: 'sop-005',
          sourceTitle: 'Comprehensive HR Onboarding',
          type: 'medium',
          description: 'Comprehensive HR onboarding includes user onboarding elements',
          reason: 'SOP-005 is expanded version of SOP-001',
          sections: [
            {from: 'week-1-tasks', to: 'prerequisites'},
            {from: 'onboarding-timeline', to: 'day-1-checklist'},
            {from: 'week-1-tasks', to: 'equipment-setup'},
            {from: 'evaluation', to: 'success-criteria'}
          ]
        }
      ]
    };

    // Render sections
    function renderSections() {
      const sectionList = document.getElementById('sectionList');
      sectionList.innerHTML = sopData.sections.map(section => {
        const depCount = section.dependsOn ? section.dependsOn.length : 0;
        const refCount = section.referencedBy ? section.referencedBy.length : 0;

        let classList = 'section-item';
        if (section.hasDependencies) classList += ' has-deps';
        if (section.isReferenced) classList += ' is-referenced';

        return `
          <li class="${classList}" onclick="highlightSection('${section.id}')">
            <div class="section-title">
              ${section.title}
              ${depCount > 0 ? `<span class="badge badge-deps">‚Üì${depCount}</span>` : ''}
              ${refCount > 0 ? `<span class="badge badge-refs">‚Üë${refCount}</span>` : ''}
            </div>
            <div class="section-meta">Section: ${section.id}</div>
          </li>
        `;
      }).join('');

      // Update counts
      document.getElementById('sectionsCount').textContent = sopData.sections.length;
      const totalSectionDeps = sopData.sections.reduce((sum, s) => sum + (s.dependsOn ? s.dependsOn.length : 0), 0);
      document.getElementById('sectionDepsCount').textContent = totalSectionDeps;
    }

    // Render outgoing dependencies
    function renderOutgoingDeps() {
      const container = document.getElementById('outgoingDeps');
      container.innerHTML = sopData.outgoingDeps.map(dep => `
        <div class="dependency-item">
          <div class="dep-item-header">
            <div>
              <span class="dep-source">${sopData.title}</span>
              <span class="dep-arrow">‚Üí</span>
              <span class="dep-target">${dep.targetTitle}</span>
            </div>
            <span class="dep-type dep-type-${dep.type}">${dep.type}</span>
          </div>
          <div class="dep-description">
            ${dep.description}
          </div>
          <div class="dep-reason">
            üí° ${dep.reason}
          </div>
          <div class="section-details">
            <strong>Section-level references:</strong>
            ${dep.sections.map(s => `
              <div class="section-ref">
                <span class="section-ref-icon">üìå</span>
                <span>Section "${s.from}" ‚Üí ${dep.target}:"${s.to}"</span>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');

      document.getElementById('outgoingCount').textContent = sopData.outgoingDeps.length;
    }

    // Render incoming dependencies
    function renderIncomingDeps() {
      const container = document.getElementById('incomingDeps');
      container.innerHTML = sopData.incomingDeps.map(dep => `
        <div class="dependency-item">
          <div class="dep-item-header">
            <div>
              <span class="dep-source">${dep.sourceTitle}</span>
              <span class="dep-arrow">‚Üí</span>
              <span class="dep-target">${sopData.title}</span>
            </div>
            <span class="dep-type dep-type-${dep.type}">${dep.type}</span>
          </div>
          <div class="dep-description">
            ${dep.description}
          </div>
          <div class="dep-reason">
            üí° ${dep.reason}
          </div>
          <div class="section-details">
            <strong>Referenced sections:</strong>
            ${dep.sections.map(s => `
              <div class="section-ref">
                <span class="section-ref-icon">üìå</span>
                <span>${dep.source}:"${s.from}" ‚Üí Section "${s.to}"</span>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');

      document.getElementById('incomingCount').textContent = sopData.incomingDeps.length;
    }

    // Render section-level dependencies
    function renderSectionDeps() {
      const container = document.getElementById('sectionDeps');

      // Collect all section-level dependencies
      const allSectionDeps = [];

      sopData.sections.forEach(section => {
        if (section.dependsOn) {
          section.dependsOn.forEach(dep => {
            allSectionDeps.push({
              sourceSection: section.id,
              sourceSectionTitle: section.title,
              targetSOP: dep.sop,
              targetSection: dep.section,
              type: dep.type
            });
          });
        }
      });

      container.innerHTML = allSectionDeps.map(dep => `
        <div class="dependency-item">
          <div class="dep-item-header">
            <div>
              <span class="dep-source">Section: ${dep.sourceSectionTitle}</span>
              <span class="dep-arrow">‚Üí</span>
              <span class="dep-target">${dep.targetSOP}:${dep.targetSection}</span>
            </div>
            <span class="dep-type dep-type-${dep.type}">${dep.type}</span>
          </div>
          <div class="dep-description">
            The "${dep.sourceSectionTitle}" section references "${dep.targetSection}" from ${dep.targetSOP}.
            ${dep.type === 'strong' ? 'This is a <strong>blocking dependency</strong> - the target must be completed first.' :
              dep.type === 'medium' ? 'This is an <strong>important reference</strong> - recommended to review together.' :
              'This is a <strong>supplementary reference</strong> - provides additional context.'}
          </div>
        </div>
      `).join('');

      document.getElementById('sectionDepsDetailCount').textContent = allSectionDeps.length;
    }

    // Update stats
    function updateStats() {
      document.getElementById('depsCount').textContent = `${sopData.outgoingDeps.length} SOPs`;
      document.getElementById('usedByCount').textContent = `${sopData.incomingDeps.length} SOP`;
    }

    // Switch between views
    function switchView(view) {
      // Update tabs
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Toggle views
      if (view === 'list') {
        document.getElementById('listView').classList.remove('hidden');
        document.getElementById('graphView').classList.remove('active');
      } else {
        document.getElementById('listView').classList.add('hidden');
        document.getElementById('graphView').classList.add('active');
      }
    }

    // Highlight section
    function highlightSection(sectionId) {
      console.log('Highlighting section:', sectionId);
      // In real implementation, would scroll to and highlight the section in the dependency list
      alert(`Section "${sectionId}" selected.\n\nIn production, this would:\n‚Ä¢ Highlight related dependencies\n‚Ä¢ Show detailed section info\n‚Ä¢ Filter the dependency view`);
    }

    // Initialize
    renderSections();
    renderOutgoingDeps();
    renderIncomingDeps();
    renderSectionDeps();
    updateStats();
  </script>
  </div> <!-- /page-wrapper -->
</body>
</html>
