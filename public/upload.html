<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload SOP - SOP Ecosystem</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    header {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    h1 {
      color: #2d3748;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #718096;
      font-size: 14px;
    }

    .upload-card {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    .drop-zone {
      border: 3px dashed #cbd5e0;
      border-radius: 10px;
      padding: 60px 20px;
      text-align: center;
      transition: all 0.3s;
      cursor: pointer;
      background: #f7fafc;
    }

    .drop-zone:hover, .drop-zone.highlight {
      border-color: #667eea;
      background: #edf2f7;
    }

    .drop-zone-icon {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .drop-zone-text {
      color: #4a5568;
      font-size: 18px;
      margin-bottom: 10px;
    }

    .drop-zone-hint {
      color: #a0aec0;
      font-size: 14px;
    }

    .file-input {
      display: none;
    }

    .uploads-list {
      margin-top: 30px;
    }

    .upload-item {
      background: #f7fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #667eea;
    }

    .upload-item.extracting {
      border-left-color: #f6ad55;
    }

    .upload-item.success {
      border-left-color: #48bb78;
    }

    .upload-item.error {
      border-left-color: #f56565;
    }

    .file-name {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
    }

    .status {
      color: #718096;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .suggestions {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e2e8f0;
    }

    .suggestions h3 {
      color: #2d3748;
      font-size: 16px;
      margin-bottom: 15px;
    }

    .suggestion-item {
      margin-bottom: 15px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
    }

    .suggestion-label {
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .suggestion-value {
      color: #2d3748;
      margin-bottom: 8px;
      padding: 8px;
      background: #f7fafc;
      border-radius: 4px;
    }

    .confidence-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }

    .confidence-high {
      background: #c6f6d5;
      color: #22543d;
    }

    .confidence-medium {
      background: #fef5e7;
      color: #975a16;
    }

    .confidence-low {
      background: #fed7d7;
      color: #742a2a;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #4a5568;
      margin-left: 10px;
    }

    .btn-secondary:hover {
      background: #cbd5e0;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 12px;
      margin-right: 8px;
    }

    .actions {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    .quick-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .quick-action-btn {
      flex: 1;
      padding: 15px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .quick-action-btn:hover {
      border-color: #667eea;
      background: #f7fafc;
    }

    .quick-action-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .quick-action-text {
      color: #4a5568;
      font-weight: 600;
      font-size: 14px;
    }

    input[type="text"], select {
      width: 100%;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      margin-top: 5px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üì§ Upload SOP</h1>
      <p class="subtitle">Add new documentation or update existing SOPs</p>
    </header>

    <div class="upload-card">
      <div class="quick-actions">
        <div class="quick-action-btn" onclick="setMode('update')">
          <div class="quick-action-icon">üîÑ</div>
          <div class="quick-action-text">Update existing SOP</div>
        </div>
        <div class="quick-action-btn" onclick="setMode('new')">
          <div class="quick-action-icon">üìù</div>
          <div class="quick-action-text">Create new SOP</div>
        </div>
      </div>

      <div class="drop-zone" id="dropZone">
        <div class="drop-zone-icon">üìÅ</div>
        <div class="drop-zone-text">Drag files here or click to browse</div>
        <div class="drop-zone-hint">Supports: PDF, DOCX, MD, HTML ‚Ä¢ Max size: 50MB</div>
        <input type="file" id="fileInput" class="file-input" accept=".pdf,.docx,.doc,.md,.html,.txt" multiple>
      </div>

      <div class="uploads-list" id="uploadsList"></div>
    </div>

    <div class="upload-card" style="background: #edf2f7;">
      <h3 style="color: #2d3748; margin-bottom: 10px;">üí° Pro Tips</h3>
      <ul style="color: #4a5568; padding-left: 20px; line-height: 1.8;">
        <li>Include version numbers in filenames (e.g., Invoice_SOP_v2.1.pdf)</li>
        <li>Use clear, descriptive titles in your documents</li>
        <li>Ensure all cross-references to other SOPs are accurate</li>
        <li>The system will auto-extract metadata - you just verify!</li>
      </ul>
    </div>
  </div>

  <script>
    let uploadMode = 'new'; // 'new' or 'update'
    let uploadQueue = [];

    function setMode(mode) {
      uploadMode = mode;
      console.log('Upload mode set to:', mode);

      // Visual feedback
      const buttons = document.querySelectorAll('.quick-action-btn');
      buttons.forEach(btn => btn.style.background = 'white');
      if (mode === 'update') {
        buttons[0].style.background = '#edf2f7';
      } else {
        buttons[1].style.background = '#edf2f7';
      }
    }

    // Drop zone functionality
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const uploadsList = document.getElementById('uploadsList');

    // Click to browse
    dropZone.addEventListener('click', () => {
      fileInput.click();
    });

    // Prevent defaults
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    // Highlight on drag
    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => {
        dropZone.classList.add('highlight');
      }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => {
        dropZone.classList.remove('highlight');
      }, false);
    });

    // Handle drop
    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const files = e.dataTransfer.files;
      handleFiles(files);
    }

    // Handle file input
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        uploadFile(file);
      });
    }

    async function uploadFile(file) {
      console.log('Uploading:', file.name);

      // Create upload item UI
      const uploadItem = createUploadItem(file);
      uploadsList.appendChild(uploadItem);

      // Simulate upload (in real implementation, this would be an actual upload)
      await simulateUpload(uploadItem, file);

      // Extract metadata
      await extractMetadata(uploadItem, file);
    }

    function createUploadItem(file) {
      const item = document.createElement('div');
      item.className = 'upload-item';
      item.innerHTML = `
        <div class="file-name">üìÑ ${file.name}</div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="status">Uploading...</div>
      `;
      return item;
    }

    async function simulateUpload(item, file) {
      const progressBar = item.querySelector('.progress-fill');
      const status = item.querySelector('.status');

      // Simulate upload progress
      for (let i = 0; i <= 100; i += 10) {
        await sleep(100);
        progressBar.style.width = i + '%';
      }

      status.textContent = '‚úÖ Uploaded ‚Ä¢ Extracting metadata...';
      item.classList.add('extracting');
    }

    async function extractMetadata(item, file) {
      const status = item.querySelector('.status');

      // Simulate extraction delay
      await sleep(1500);

      // Mock extraction results
      const extraction = await mockExtraction(file);

      // Remove progress bar
      item.querySelector('.progress-bar').style.display = 'none';
      status.textContent = '‚úÖ Metadata extracted';
      item.classList.remove('extracting');
      item.classList.add('success');

      // Show suggestions
      showSuggestions(item, extraction);
    }

    async function mockExtraction(file) {
      // Mock metadata extraction based on filename
      const filename = file.name;

      // Extract version from filename
      const versionMatch = filename.match(/v?(\d+\.\d+\.?\d*)/i);
      const version = versionMatch ? versionMatch[1] : '1.0.0';

      // Extract title (remove extension and version)
      let title = filename.replace(/\.(pdf|docx?|md|html|txt)$/i, '');
      title = title.replace(/[-_]v?\d+\.\d+\.?\d*/i, '');
      title = title.replace(/[-_]/g, ' ');
      title = title.replace(/\b\w/g, l => l.toUpperCase());

      // Mock owner detection
      const owners = ['Finance Department', 'IT Department', 'HR Department', 'Operations', 'Legal Department'];
      const owner = owners[Math.floor(Math.random() * owners.length)];

      // Mock systems detected
      const systems = ['Workday', 'SAP', 'Salesforce', 'Active Directory'];
      const detectedSystems = systems.slice(0, Math.floor(Math.random() * 3) + 1);

      return {
        title: title,
        titleConfidence: 0.92,
        version: version,
        versionConfidence: versionMatch ? 0.98 : 0.65,
        owner: owner,
        ownerConfidence: 0.75,
        systems: detectedSystems,
        mode: uploadMode
      };
    }

    function showSuggestions(item, data) {
      const suggestionsHtml = `
        <div class="suggestions">
          <h3>I found this in your document:</h3>

          <div class="suggestion-item">
            <div class="suggestion-label">
              üìã Title
              <span class="confidence-badge ${getConfidenceClass(data.titleConfidence)}">
                ${Math.round(data.titleConfidence * 100)}% confident
              </span>
            </div>
            <div class="suggestion-value">${data.title}</div>
            <button class="btn btn-small btn-secondary" onclick="editField(this, 'title')">Edit</button>
            <button class="btn btn-small btn-primary" onclick="acceptField(this, 'title')">Looks good ‚úì</button>
          </div>

          <div class="suggestion-item">
            <div class="suggestion-label">
              üë§ Owner
              <span class="confidence-badge ${getConfidenceClass(data.ownerConfidence)}">
                ${Math.round(data.ownerConfidence * 100)}% confident
              </span>
            </div>
            <div class="suggestion-value">${data.owner}</div>
            <button class="btn btn-small btn-secondary" onclick="editField(this, 'owner')">Edit</button>
            <button class="btn btn-small btn-primary" onclick="acceptField(this, 'owner')">Looks good ‚úì</button>
          </div>

          <div class="suggestion-item">
            <div class="suggestion-label">
              üî¢ Version
              <span class="confidence-badge ${getConfidenceClass(data.versionConfidence)}">
                ${Math.round(data.versionConfidence * 100)}% confident
              </span>
            </div>
            <div class="suggestion-value">${data.version}</div>
            <button class="btn btn-small btn-secondary" onclick="editField(this, 'version')">Edit</button>
            <button class="btn btn-small btn-primary" onclick="acceptField(this, 'version')">Looks good ‚úì</button>
          </div>

          <div class="suggestion-item">
            <div class="suggestion-label">üîó Systems detected</div>
            <div class="suggestion-value">${data.systems.join(', ')}</div>
          </div>

          ${data.mode === 'update' ? `
            <div class="suggestion-item">
              <div class="suggestion-label">üìù What changed?</div>
              <label style="display: block; margin: 8px 0;">
                <input type="checkbox" style="width: auto; margin-right: 5px;">
                Process steps
              </label>
              <label style="display: block; margin: 8px 0;">
                <input type="checkbox" style="width: auto; margin-right: 5px;">
                Systems/tools
              </label>
              <label style="display: block; margin: 8px 0;">
                <input type="checkbox" style="width: auto; margin-right: 5px;">
                Requirements
              </label>
              <label style="display: block; margin: 8px 0;">
                <input type="checkbox" style="width: auto; margin-right: 5px;">
                Roles
              </label>
            </div>
          ` : ''}

          <div class="actions">
            <button class="btn btn-primary" onclick="submitForReview(this)">
              ${data.mode === 'update' ? 'Update SOP ‚Üí' : 'Create SOP ‚Üí'}
            </button>
            <button class="btn btn-secondary" onclick="showAdvanced(this)">
              Show advanced options ‚ñº
            </button>
          </div>
        </div>
      `;

      item.insertAdjacentHTML('beforeend', suggestionsHtml);
    }

    function getConfidenceClass(confidence) {
      if (confidence >= 0.85) return 'confidence-high';
      if (confidence >= 0.65) return 'confidence-medium';
      return 'confidence-low';
    }

    function editField(button, field) {
      const item = button.closest('.suggestion-item');
      const valueDiv = item.querySelector('.suggestion-value');
      const currentValue = valueDiv.textContent;

      valueDiv.innerHTML = `<input type="text" value="${currentValue}" style="width: 100%;">`;
      valueDiv.querySelector('input').focus();

      button.textContent = 'Save';
      button.onclick = () => saveField(button, field);
    }

    function saveField(button, field) {
      const item = button.closest('.suggestion-item');
      const input = item.querySelector('input[type="text"]');
      const newValue = input.value;

      item.querySelector('.suggestion-value').textContent = newValue;

      button.textContent = 'Edit';
      button.onclick = () => editField(button, field);

      console.log('Field updated:', field, '=', newValue);
    }

    function acceptField(button, field) {
      button.textContent = '‚úì Accepted';
      button.disabled = true;
      button.style.opacity = '0.6';
      console.log('Field accepted:', field);
    }

    function submitForReview(button) {
      const uploadItem = button.closest('.upload-item');
      const status = uploadItem.querySelector('.status');

      // Simulate submission
      button.textContent = 'Submitting...';
      button.disabled = true;

      setTimeout(() => {
        status.innerHTML = `
          <strong style="color: #48bb78;">‚úÖ Submitted for review!</strong><br>
          <span style="font-size: 12px;">You'll be notified when it's published.</span><br>
          <a href="/status-dashboard.html" style="color: #667eea; font-size: 12px;">Track status ‚Üí</a>
        `;

        // Hide suggestions
        uploadItem.querySelector('.suggestions').style.display = 'none';
      }, 1000);
    }

    function showAdvanced(button) {
      alert('Advanced options would show additional fields:\n‚Ä¢ Tags\n‚Ä¢ Related SOPs\n‚Ä¢ Compliance frameworks\n‚Ä¢ Review frequency\n‚Ä¢ Effective date');
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Initialize with 'new' mode selected
    setMode('new');
  </script>
</body>
</html>
