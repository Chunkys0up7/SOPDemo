<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; script-src 'self' 'unsafe-inline' cdn.jsdelivr.net unpkg.com; img-src 'self' data:;">
    <title>My Workspace - Pursuit Bank SOP Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/public/assets/css/common.css">
    <!-- Page-specific inline styles migrated to /public/assets/css/common.css -->
</head>
<body>
    <!-- Include Global Navigation -->
    <div id="global-nav-container"></div>
    <!-- Header -->
    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Left Panel: SOP List -->
        <div class="sop-panel">
            <div class="panel-header">
                <h2><span class="tooltip">SOPs<span class="tooltip-content">Standard Operating Procedures - documented step-by-step processes for consistent operations across the organization</span></span></h2>
                <input type="text" class="search-box" placeholder="Search SOPs..." id="sop-search">
            </div>
            <div class="sop-list" id="sop-list">
                <!-- Populated by JavaScript -->
            </div>
        </div>

        <!-- Center Panel: Process Builder -->
        <div class="process-panel">
            <div class="process-header">
                <div class="process-title" id="process-title">My Workspace</div>
                <div class="process-actions">
                    <button class="btn btn-secondary" id="btn-view-graph">
                        <span class="tooltip">View in Graph<span class="tooltip-content">Open this SOP in the visual dependency graph to see all connections and relationships</span></span>
                    </button>
                    <button class="btn btn-primary" id="btn-generate">
                        <span class="tooltip">Generate Process<span class="tooltip-content">AI creates a step-by-step workflow based on this SOP and its dependencies for your specific use case</span></span>
                    </button>
                </div>
            </div>
            <div class="process-content" id="process-content">
                <div class="empty-state">
                    <div class="empty-state-icon">ðŸ“‹</div>
                    <div class="empty-state-title">Select an SOP to get started</div>
                    <div class="empty-state-text">Choose from the list on the left to view details and generate processes</div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Dependencies & Actions -->
        <div class="deps-panel">
            <div class="panel-header">
                <h2>Quick Actions</h2>
            </div>
            <div class="deps-content" id="deps-content">
                <div class="quick-action" onclick="window.location.href='graph.html'">
                    <div class="quick-action-title">View Dependency Graph</div>
                    <div class="quick-action-desc">Visualize SOP relationships</div>
                </div>
                <div class="quick-action" onclick="window.location.href='contribute.html'">
                    <div class="quick-action-title">Create New SOP</div>
                    <div class="quick-action-desc">Add to the library</div>
                </div>
                <div class="quick-action" onclick="window.location.href='search.html'">
                    <div class="quick-action-title">Semantic Search</div>
                    <div class="quick-action-desc">Find SOPs by description</div>
                </div>

                <div class="deps-title">
                    <span class="tooltip">Dependencies<span class="tooltip-content">SOPs that this procedure requires or references. Changes to dependencies may affect this SOP's functionality.</span></span>
                </div>
                <div id="deps-list">
                    <p class="deps-placeholder">Select an SOP to view dependencies</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sopDatabase = [
            {
                id: 'sop-mf-001',
                title: 'FHA Underwriting Guidelines',
                department: 'Mortgage',
                status: 'active',
                version: '2.1.0',
                owner: 'Mortgage Operations',
                purpose: 'Standardized procedure for underwriting FHA loans to ensure compliance with HUD requirements.',
                steps: [
                    'Review borrower credit report and verify minimum credit score of 580 for 3.5% down payment',
                    'Calculate debt-to-income ratio, ensuring it does not exceed 43%',
                    'Verify employment history for minimum 2 years continuous employment',
                    'Order FHA-approved appraisal to determine property value',
                    'Review and approve all required FHA documentation'
                ],
                dependencies: [
                    { id: 'sop-mf-003', title: 'Credit Report Analysis', type: 'depends-on' },
                    { id: 'sop-mf-005', title: 'Property Appraisal Review', type: 'depends-on' }
                ],
                components: [
                    { type: 'atom', name: 'Credit Score Verification' },
                    { type: 'atom', name: 'DTI Calculation Form' },
                    { type: 'molecule', name: 'Employment Verification Workflow' }
                ]
            },
            {
                id: 'sop-mf-002',
                title: 'Conventional Loan Underwriting',
                department: 'Mortgage',
                status: 'active',
                version: '3.0.2',
                owner: 'Mortgage Operations',
                purpose: 'Process for underwriting conventional loans following Fannie Mae and Freddie Mac guidelines.',
                steps: [
                    'Verify minimum credit score of 620 for conventional loan eligibility',
                    'Calculate loan-to-value ratio based on down payment and purchase price',
                    'Review automated underwriting system (DU/LP) findings',
                    'Verify all income documentation including tax returns and pay stubs',
                    'Complete final loan approval and generate commitment letter'
                ],
                dependencies: [
                    { id: 'sop-mf-003', title: 'Credit Report Analysis', type: 'depends-on' },
                    { id: 'sop-mf-004', title: 'Income Verification', type: 'depends-on' }
                ],
                components: [
                    { type: 'atom', name: 'LTV Calculator' },
                    { type: 'molecule', name: 'AUS Processing Workflow' },
                    { type: 'organism', name: 'Complete Underwriting Package' }
                ]
            },
            {
                id: 'sop-mf-006',
                title: 'Clear to Close Process',
                department: 'Mortgage',
                status: 'active',
                version: '1.5.0',
                owner: 'Closing Department',
                purpose: 'Final verification and approval process before loan closing.',
                steps: [
                    'Verify all conditions from underwriting approval have been satisfied',
                    'Review title commitment and ensure clear title',
                    'Confirm hazard insurance coverage is in place',
                    'Verify employment one last time (72 hours before closing)',
                    'Generate final closing disclosure and send to borrower',
                    'Issue clear to close authorization to closing agent'
                ],
                dependencies: [
                    { id: 'sop-mf-001', title: 'FHA Underwriting Guidelines', type: 'depends-on' },
                    { id: 'sop-mf-002', title: 'Conventional Loan Underwriting', type: 'depends-on' }
                ],
                components: [
                    { type: 'molecule', name: 'Final Verification Checklist' },
                    { type: 'molecule', name: 'Title Review Process' }
                ]
            },
            {
                id: 'sop-comp-001',
                title: 'AML Transaction Monitoring',
                department: 'Compliance',
                status: 'active',
                version: '2.3.0',
                owner: 'Compliance Department',
                purpose: 'Procedures for monitoring and reporting suspicious financial activities.',
                steps: [
                    'Review automated alerts from transaction monitoring system',
                    'Investigate flagged transactions for suspicious patterns',
                    'Document all findings in case management system',
                    'Escalate high-risk cases to BSA Officer',
                    'File SAR (Suspicious Activity Report) if necessary'
                ],
                dependencies: [],
                components: [
                    { type: 'atom', name: 'Alert Review Form' },
                    { type: 'molecule', name: 'Investigation Workflow' }
                ]
            },
            {
                id: 'sop-hr-001',
                title: 'Employee Onboarding',
                department: 'HR',
                status: 'active',
                version: '1.8.0',
                owner: 'Human Resources',
                purpose: 'Complete onboarding process for new employees.',
                steps: [
                    'Complete new hire paperwork and I-9 verification',
                    'Set up employee in payroll and benefits systems',
                    'Provision IT accounts and equipment',
                    'Conduct orientation and compliance training',
                    'Assign mentor and review 90-day goals'
                ],
                dependencies: [
                    { id: 'sop-it-001', title: 'IT Account Provisioning', type: 'depends-on' }
                ],
                components: [
                    { type: 'atom', name: 'I-9 Form' },
                    { type: 'atom', name: 'Benefits Enrollment Form' },
                    { type: 'organism', name: 'Complete Onboarding Workflow' }
                ]
            }
        ];

        let currentSOP = null;

        // Populate SOP list
        function renderSOPList(filter = '') {
            const listEl = document.getElementById('sop-list');
            const filtered = sopDatabase.filter(sop =>
                sop.title.toLowerCase().includes(filter.toLowerCase()) ||
                sop.department.toLowerCase().includes(filter.toLowerCase())
            );

            listEl.innerHTML = filtered.map(sop => `
                <div class="sop-item" onclick="selectSOP('${sop.id}')">
                    <div class="sop-item-title">${sop.title}</div>
                    <div class="sop-item-meta">${sop.department} â€¢ v${sop.version}</div>
                </div>
            `).join('');
        }

        // Select SOP
        function selectSOP(id) {
            currentSOP = sopDatabase.find(sop => sop.id === id);
            if (!currentSOP) return;

            // Update active state
            document.querySelectorAll('.sop-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.sop-item').classList.add('active');

            // Render SOP details
            renderSOPDetails();
            renderDependencies();
        }

        // Render SOP details
        function renderSOPDetails() {
            if (!currentSOP) return;

            const contentEl = document.getElementById('process-content');
            document.getElementById('process-title').textContent = currentSOP.title;

            contentEl.innerHTML = `
                <div class="sop-details">
                    <div class="sop-header-section">
                        <div class="sop-main-title">${currentSOP.title}</div>
                        <div class="sop-metadata">
                            <div class="meta-item">
                                <strong>Status:</strong>
                                <span class="badge badge-active">${currentSOP.status}</span>
                            </div>
                            <div class="meta-item">
                                <strong>Department:</strong>
                                <span class="badge badge-mortgage">${currentSOP.department}</span>
                            </div>
                            <div class="meta-item">
                                <strong>Version:</strong> ${currentSOP.version}
                            </div>
                            <div class="meta-item">
                                <strong>Owner:</strong> ${currentSOP.owner}
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">Purpose</div>
                        <div class="section-content">${currentSOP.purpose}</div>
                    </div>

                    <div class="section">
                        <div class="section-title">Procedure</div>
                        <ol class="procedure-steps">
                            ${currentSOP.steps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>

                    ${currentSOP.components.length > 0 ? `
                    <div class="section">
                        <div class="section-title">
                            <span class="tooltip">Reusable Components<span class="tooltip-content">Modular building blocks following Atomic Design - small pieces that can be reused across multiple SOPs to eliminate duplication</span></span>
                        </div>
                        <div class="component-grid">
                            ${currentSOP.components.map(comp => {
                                const tooltips = {
                                    'atom': 'Basic reusable element (forms, checklists, templates) that cannot be broken down further',
                                    'molecule': 'Simple process combining multiple atoms into a single function or workflow',
                                    'organism': 'Complete end-to-end workflow combining atoms and molecules into a full procedure'
                                };
                                return `
                                <div class="component-card">
                                    <div class="component-type">
                                        <span class="tooltip">${comp.type}<span class="tooltip-content">${tooltips[comp.type]}</span></span>
                                    </div>
                                    <div class="component-name">${comp.name}</div>
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // Render dependencies
        function renderDependencies() {
            if (!currentSOP) return;

            const depsEl = document.getElementById('deps-list');

            if (currentSOP.dependencies.length === 0) {
                depsEl.innerHTML = '<p class="deps-placeholder">No dependencies</p>';
                return;
            }

            depsEl.innerHTML = currentSOP.dependencies.map(dep => {
                const typeTooltips = {
                    'depends-on': 'This SOP requires the referenced procedure to function correctly',
                    'related-to': 'This SOP has connections or shared concepts with the referenced procedure',
                    'component-of': 'This SOP uses components from the referenced procedure'
                };
                return `
                <div class="dep-item" onclick="selectSOPById('${dep.id}')">
                    <div class="dep-item-title">${dep.title}</div>
                    <div class="dep-item-type">
                        <span class="tooltip">${dep.type}<span class="tooltip-content">${typeTooltips[dep.type] || dep.type}</span></span>
                    </div>
                </div>
            `}).join('');
        }

        // Select SOP by ID
        function selectSOPById(id) {
            const sopItem = document.querySelector(`.sop-item[onclick="selectSOP('${id}')"]`);
            if (sopItem) {
                sopItem.click();
            }
        }

        // Search
        document.getElementById('sop-search').addEventListener('input', function(e) {
            renderSOPList(e.target.value);
        });

        // View in graph
        document.getElementById('btn-view-graph').addEventListener('click', function() {
            if (currentSOP) {
                window.location.href = 'graph.html';
            }
        });

        // Generate process
        document.getElementById('btn-generate').addEventListener('click', function() {
            if (!currentSOP) {
                alert('Please select an SOP first');
                return;
            }

            alert(`Process generation for "${currentSOP.title}" will be implemented with AI assistance to create step-by-step workflows based on this SOP.`);
        });

        // Initialize
        renderSOPList();
    </script>

    <!-- Load Global Navigation -->
    <script>
        fetch('/public/components/global-nav.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('global-nav-container').innerHTML = html;
            });
    </script>
</body>
</html>
